import{c as U,f as y,q as b,o as q,w as S,h as B,i as M,k as m,l as _,m as $,n as C,s as h,p as V,F as f,t as p,v as G,r as i}from"./index-PcNZ_Iqf.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],et=U("calendar",j),z=async(e,t)=>{const a=y(p,f.APPLICATIONS),n={...t,userId:e,interviewNotes:[],createdAt:h(),updatedAt:h()};return(await M(a,n)).id},H=async(e,t)=>{const a=m(p,f.APPLICATIONS,e);await _(a,{...t,updatedAt:h()})},J=async e=>{const t=m(p,f.APPLICATIONS,e);await $(t)},K=async(e,t=[])=>{const a=y(p,f.APPLICATIONS),n=b(a,S("userId","==",e),...t);return(await V(n)).docs.map(l=>{const c=l.data();return{id:l.id,...c,createdAt:c.createdAt?.toDate?c.createdAt.toDate():new Date(c.createdAt),updatedAt:c.updatedAt?.toDate?c.updatedAt.toDate():new Date(c.updatedAt)}})},Q=(e,t,a)=>{const n=y(p,f.APPLICATIONS),u=b(n,S("userId","==",e),q("createdAt","desc"));return B(u,l=>{const c=l.docs.map(A=>{const r=A.data();return{id:A.id,...r,createdAt:r.createdAt?.toDate?r.createdAt.toDate():new Date(r.createdAt),updatedAt:r.updatedAt?.toDate?r.updatedAt.toDate():new Date(r.updatedAt)}});t(c)},a)},W=async e=>{const t=C(p);e.forEach(({id:a,data:n})=>{const u=m(p,f.APPLICATIONS,a);t.update(u,{...n,updatedAt:h()})}),await t.commit()},X=async e=>{const t=C(p);e.forEach(a=>{const n=m(p,f.APPLICATIONS,a);t.delete(n)}),await t.commit()},at=(e,t="USD")=>{const a=typeof e=="string"?parseFloat(e):e;return isNaN(a)?"":new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(a)},Y=(e,t)=>e.filter(a=>{if(t.status?.length&&!t.status.includes(a.status)||t.companies?.length&&!t.companies.includes(a.company))return!1;if(t.dateRange){const n=new Date(a.dateApplied),u=new Date(t.dateRange.start),l=new Date(t.dateRange.end);if(n<u||n>l)return!1}if(t.searchTerm){const n=t.searchTerm.toLowerCase();if(!`${a.title} ${a.company} ${a.notes||""}`.toLowerCase().includes(n))return!1}return!0}),Z=(e,t,a)=>[...e].sort((n,u)=>{let l=n[t],c=u[t];return(t==="dateApplied"||t==="createdAt"||t==="updatedAt")&&(l=new Date(l).getTime(),c=new Date(c).getTime()),typeof l=="string"&&(l=l.toLowerCase(),c=c.toLowerCase()),l<c?a==="asc"?-1:1:l>c?a==="asc"?1:-1:0}),st=e=>{const t={total:e.length,byStatus:{},responseRate:0,averageResponseTime:0,offerRate:0};e.forEach(n=>{t.byStatus[n.status]=(t.byStatus[n.status]||0)+1});const a=e.filter(n=>!["Applied","Ghosted"].includes(n.status)).length;return t.responseRate=t.total>0?a/t.total*100:0,t.offerRate=t.total>0?(t.byStatus.Offer||0)/t.total*100:0,t},nt=()=>{const{user:e}=G(),[t,a]=i.useState([]),[n,u]=i.useState([]),[l,c]=i.useState(!0),[A,r]=i.useState(null),[w,I]=i.useState({}),[g,R]=i.useState("createdAt"),[D,E]=i.useState("desc");i.useEffect(()=>{let o=Y(t,w);o=Z(o,g,D),u(o)},[t,w,g,D]),i.useEffect(()=>{if(!e){a([]),u([]),c(!1);return}return c(!0),r(null),Q(e.uid,s=>{a(s),c(!1)},s=>{r(s.message),c(!1)})},[e]);const T=i.useCallback(async o=>{if(!e)throw new Error("User not authenticated");try{return r(null),await z(e.uid,o)}catch(s){const d=s instanceof Error?s.message:"Failed to create application";throw r(d),s}},[e]),L=i.useCallback(async(o,s)=>{try{r(null),await H(o,s)}catch(d){const x=d instanceof Error?d.message:"Failed to update application";throw r(x),d}},[]),k=i.useCallback(async o=>{try{r(null),await J(o)}catch(s){const d=s instanceof Error?s.message:"Failed to delete application";throw r(d),s}},[]),P=i.useCallback(async o=>{try{r(null),await W(o)}catch(s){const d=s instanceof Error?s.message:"Failed to update applications";throw r(d),s}},[]),N=i.useCallback(async o=>{try{r(null),await X(o)}catch(s){const d=s instanceof Error?s.message:"Failed to delete applications";throw r(d),s}},[]),F=i.useCallback(async()=>{if(e)try{c(!0),r(null);const o=await K(e.uid);a(o)}catch(o){const s=o instanceof Error?o.message:"Failed to refresh applications";r(s)}finally{c(!1)}},[e]),O=i.useCallback(o=>{I(o)},[]),v=i.useCallback((o,s)=>{R(o),E(s)},[]);return{applications:t,loading:l,error:A,create:T,update:L,remove:k,batchUpdate:P,batchDelete:N,refresh:F,filter:O,sort:v,filteredApplications:n}};export{et as C,at as f,st as g,nt as u};
