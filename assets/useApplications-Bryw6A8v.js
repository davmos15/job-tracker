import{c as $,f as y,q as b,o as B,w as I,h as M,i as _,k as h,l as m,m as V,n as C,s as w,p as G,t as g,F as f,v as p,x as j,r as l}from"./index-DXVxketP.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],at=$("calendar",z),H=async(e,t)=>{const a=y(p,f.APPLICATIONS),s={...t,userId:e,interviewNotes:[],createdAt:w(),updatedAt:w()};return(await _(a,s)).id},J=async(e,t)=>{const a=h(p,f.APPLICATIONS,e);await m(a,{...t,updatedAt:w()})},K=async e=>{const t=h(p,f.APPLICATIONS,e);await V(t)},Q=async(e,t=[])=>{const a=y(p,f.APPLICATIONS),s=b(a,I("userId","==",e),...t);return(await G(s)).docs.map(i=>{const n=i.data();return{id:i.id,...n,createdAt:n.createdAt?.toDate?n.createdAt.toDate():new Date(n.createdAt),updatedAt:n.updatedAt?.toDate?n.updatedAt.toDate():new Date(n.updatedAt)}})},W=(e,t,a)=>{const s=y(p,f.APPLICATIONS),d=b(s,I("userId","==",e),B("createdAt","desc"));return M(d,i=>{const n=i.docs.map(A=>{const r=A.data();return{id:A.id,...r,createdAt:r.createdAt?.toDate?r.createdAt.toDate():new Date(r.createdAt),updatedAt:r.updatedAt?.toDate?r.updatedAt.toDate():new Date(r.updatedAt)}});t(n)},a)},X=async e=>{const t=C(p);e.forEach(({id:a,data:s})=>{const d=h(p,f.APPLICATIONS,a);t.update(d,{...s,updatedAt:w()})}),await t.commit()},Y=async e=>{const t=C(p);e.forEach(a=>{const s=h(p,f.APPLICATIONS,a);t.delete(s)}),await t.commit()},st=async(e,t)=>{const a=h(p,f.APPLICATIONS,e),s=await g(a);if(!s.exists())throw new Error("Application not found");const d=s.data().interviewNotes||[],i={...t,id:`note-${Date.now()}`};await m(a,{interviewNotes:[...d,i],updatedAt:w()})},nt=async(e,t,a)=>{const s=h(p,f.APPLICATIONS,e),d=await g(s);if(!d.exists())throw new Error("Application not found");const n=(d.data().interviewNotes||[]).map(A=>A.id===t?{...A,...a}:A);await m(s,{interviewNotes:n,updatedAt:w()})},ot=async(e,t)=>{const a=h(p,f.APPLICATIONS,e),s=await g(a);if(!s.exists())throw new Error("Application not found");const i=(s.data().interviewNotes||[]).filter(n=>n.id!==t);await m(a,{interviewNotes:i,updatedAt:w()})},ct=(e,t="USD")=>{const a=typeof e=="string"?parseFloat(e):e;return isNaN(a)?"":new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(a)},Z=(e,t)=>e.filter(a=>{if(t.status?.length&&!t.status.includes(a.status)||t.companies?.length&&!t.companies.includes(a.company))return!1;if(t.dateRange){const s=new Date(a.dateApplied),d=new Date(t.dateRange.start),i=new Date(t.dateRange.end);if(s<d||s>i)return!1}if(t.searchTerm){const s=t.searchTerm.toLowerCase();if(!`${a.title} ${a.company} ${a.notes||""}`.toLowerCase().includes(s))return!1}return!0}),tt=(e,t,a)=>[...e].sort((s,d)=>{let i=s[t],n=d[t];return(t==="dateApplied"||t==="createdAt"||t==="updatedAt")&&(i=new Date(i).getTime(),n=new Date(n).getTime()),typeof i=="string"&&(i=i.toLowerCase(),n=n.toLowerCase()),i<n?a==="asc"?-1:1:i>n?a==="asc"?1:-1:0}),rt=e=>{const t={total:e.length,byStatus:{},responseRate:0,averageResponseTime:0,offerRate:0};e.forEach(s=>{t.byStatus[s.status]=(t.byStatus[s.status]||0)+1});const a=e.filter(s=>!["Applied","Ghosted"].includes(s.status)).length;return t.responseRate=t.total>0?a/t.total*100:0,t.offerRate=t.total>0?(t.byStatus.Offer||0)/t.total*100:0,t},it=()=>{const{user:e}=j(),[t,a]=l.useState([]),[s,d]=l.useState([]),[i,n]=l.useState(!0),[A,r]=l.useState(null),[D,R]=l.useState({}),[N,E]=l.useState("createdAt"),[S,P]=l.useState("desc");l.useEffect(()=>{let c=Z(t,D);c=tt(c,N,S),d(c)},[t,D,N,S]),l.useEffect(()=>{if(!e){a([]),d([]),n(!1);return}return n(!0),r(null),W(e.uid,o=>{a(o),n(!1)},o=>{r(o.message),n(!1)})},[e]);const T=l.useCallback(async c=>{if(!e)throw new Error("User not authenticated");try{return r(null),await H(e.uid,c)}catch(o){const u=o instanceof Error?o.message:"Failed to create application";throw r(u),o}},[e]),L=l.useCallback(async(c,o)=>{try{r(null),await J(c,o)}catch(u){const q=u instanceof Error?u.message:"Failed to update application";throw r(q),u}},[]),v=l.useCallback(async c=>{try{r(null),await K(c)}catch(o){const u=o instanceof Error?o.message:"Failed to delete application";throw r(u),o}},[]),k=l.useCallback(async c=>{try{r(null),await X(c)}catch(o){const u=o instanceof Error?o.message:"Failed to update applications";throw r(u),o}},[]),O=l.useCallback(async c=>{try{r(null),await Y(c)}catch(o){const u=o instanceof Error?o.message:"Failed to delete applications";throw r(u),o}},[]),F=l.useCallback(async()=>{if(e)try{n(!0),r(null);const c=await Q(e.uid);a(c)}catch(c){const o=c instanceof Error?c.message:"Failed to refresh applications";r(o)}finally{n(!1)}},[e]),x=l.useCallback(c=>{R(c)},[]),U=l.useCallback((c,o)=>{E(c),P(o)},[]);return{applications:t,loading:i,error:A,create:T,update:L,remove:v,batchUpdate:k,batchDelete:O,refresh:F,filter:x,sort:U,filteredApplications:s}};export{at as C,nt as a,st as b,ot as d,ct as f,rt as g,it as u};
